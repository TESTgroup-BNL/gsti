---
title: "How to add your dataset?"
output: md_document
date: "2022-09-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Creation of a Dataset folder

Each dataset is put into a folder called "Names_Year" for example "Serbin_et_al_2019". 
Please, also add any article associated with the dataset or the protocol of measurement, which should include the description of the gas exchange measurements, leaf reflectance measurements, as well as the equipments used. It should also include the location description, information on the growing conditions (Natural environment? Green house? Agricultural or experimental field? Plants in pots?) and information on the species (Natural species, agricultural species) as well as the status of the plants (stressed, not stressed?)

## Description of the dataset

In each dataset folder a csv file called Description.csv has to be included. An example is given in the Folder 0_Template. The latitude and longitude coordinates will be used to position the dataset on a world map.

```{r}
Description=read.csv(file='Description.csv')
knitr::kable(Description, "html")
```

## Adding the gas exchange A-Ci data to the dataset folder

The idea of this project is to include the raw A-Ci data so we can fit the curves and estimate Vcmax using the same method for all datasets.

We have requirements for the final A-Ci data to be used by the fitting procedure (see table below with the needed column names). However, we don't have hard requirements in the way to obtain this final data. Note that the SampleID_num column will be used by the fitting procedure to identify individual A-Ci curves. If you made several A-Ci curves on the same leaf we recommend to only keep the best one. We decided to use a column SampleId and a column SampleID_num. SampleID should correspond to the original identifier of the leaves in the raw dataset which is often a complex string. The column SampleID_num should be an integer. We made the choice to use the SampleID_num to facilitate the QAQC of the curves and the ploting of the figures (title name). 

The A-Ci data should be cleaned from spurious measurements and points that would impact Vcmax or Jmax estimation should not be included. 

The curated A-Ci data should be present in the dataset folder in a Rdata format called '1_QC_data.Rdata' which contains the A-Ci data in a data.frame with at least the columns listed in the table below.

Note that we usually include in the dataset folder the raw data, as well as the R code used to read, import and transform the raw data. All those preliminary steps are made in a R code called 'Import_transform_original_ACi_data.R'.We recommend to do the same, but again, we don't have requirements on the code to do that.

We also include the code used to check the quality of the A-Ci data where we flag the bad points and delete the bad curves. This code is called '1_QaQc_curated_ACi.R' and produces the file '1_QC_data.Rdata'. This code usually produces a PDF file with a plot of each of the A-Ci curves with the good point in dark and the bad points in red. You can find some examples in the different dataset folders.

We are usually quite severe on the quality analysis to only keep the curves where the estimation of Vcmax will be good. If we have doubts on the quality of the data we tend to remove them from the final curated data.

```{r}
Aci_data=read.csv(file='Aci_data.csv')
knitr::kable(Aci_data, "html")
```

## Fitting the A_Ci data to estimate the photosynthetic traits

The fitting of each individual curves is done using the package LeafGasExchange by a R code called '2_Fit_ACi.R' included in each dataset folder.

This code produces several pdf files:

-   2_ACi_fitting_Ac.pdf

-   2_ACi_fitting_Ac_Aj.pdf

-   2_ACi_fitting_Ac_Aj_Ap.pdf

and

-   2_ACi_fitting_best_model.pdf

The first three pdf shows the fitting of each A-Ci curves when including the rate of maximum carboxylation (Ac), the rate of electron transport (Aj) and the rate of triose phosphate utilisation (Ap). The best model corresponds to the model with the lowest AIC that includes Ac or Ac + Aj or Ac + Aj + Ap.

Note that in all the cases, the transition between Ac, Aj and Ap rates is determined automatically by the fitting procedure to avoid manual and somehow subjective choices in the transitions (References).

This codes produces a dataframe, called Bilan which includes the folowing column: 

```{r}
Bilan=read.csv(file='Bilan.csv')
knitr::kable(Bilan, "html")
```



## Adding the leaf species and metadata information

In the code '2_Fit_ACi.R' we add the sample information to the the dataframe Bilan that contains the photosynthetic parameters. 

XXX Column


## Adding the leaf spectra data

